"use strict";(()=>{var e={};e.id=336,e.ids=[336],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},73292:e=>{e.exports=require("fs/promises")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},28552:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>k,originalPathname:()=>x,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>I});var o={};t.r(o),t.d(o,{DELETE:()=>g,GET:()=>l,PATCH:()=>y});var s=t(10884),n=t(16132),a=t(21040),i=t(34581);t(73292);var p=t(67859),u=t(9816),c=t(53311),d=t.n(c);let l=async(e,{params:r})=>{try{await (0,p.P)();let e=await i.Z.findById(r.id).populate("creator");if(!e)return new Response("The Work Not Found",{status:404});return new Response(JSON.stringify(e),{status:200})}catch(e){return new Response("Internal Server Error",{status:500})}},y=async(e,{params:r})=>{try{await (0,p.P)();let t=await e.formData(),o=(0,u.eI)("https://frsmcjzgunhzcsxffmyj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyc21janpndW5oemNzeGZmbXlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDIyNTYwMjIsImV4cCI6MjAxNzgzMjAyMn0.7E5qeYynBjG6npduH8eUtm2rUuSnfOOdNbZnV9AHRJw");t.get("creator");let s=t.get("category"),n=t.get("title"),a=t.get("description"),c=t.get("price"),l=t.getAll("workPhotoPaths"),y=[];for(let e of l)if(e instanceof Object){let r=e.name.split(".").pop(),t=d()()+"."+r,s=await e.arrayBuffer(),n=Buffer.from(s),a=`${t}`,{data:i,error:p}=await o.storage.from("fastfastfood").upload(a,n,{contentType:e.type,upsert:!0});if(p)return console.error(p),new Response("Error updating the Work",{status:500});y.push(i.Key),console.log("updated")}else y.push(e),console.log(e);let g=await i.Z.findById(r.id);if(!g)return new Response("The Work Not Found",{status:404});return g.category=s,g.title=n,g.description=a,g.price=c,g.workPhotoPaths=y,await g.save(),new Response("Successfully updated the Work",{status:200})}catch(e){return console.error(e),new Response("Error updating the Work",{status:500})}},g=async(e,{params:r})=>{try{return await (0,p.P)(),await i.Z.findByIdAndDelete(r.id),new Response("Successfully deleted the Work",{status:200})}catch(e){return console.log(e),new Response("Error deleting the Work",{status:500})}},h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/work/[id]/route",pathname:"/api/work/[id]",filename:"route",bundlePath:"app/api/work/[id]/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\mimarket\\app\\api\\work\\[id]\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:m,headerHooks:k,staticGenerationBailout:I}=h,x="/api/work/[id]/route";function q(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:w})}},34581:(e,r,t)=>{t.d(r,{Z:()=>a});var o=t(11185);let s=new o.Schema({creator:{type:o.Schema.Types.ObjectId,ref:"User"},category:{type:String},title:{type:String},description:{type:String},price:{type:Number},workPhotoPaths:[{type:String}]}),n=o.models.Work||(0,o.model)("Work",s),a=n},67859:(e,r,t)=>{t.d(r,{P:()=>a});var o=t(11185),s=t.n(o);let n=!1,a=async()=>{s().set("strictQuery",!0);try{if(n){console.log("MongoDB is already connected!");return}await s().connect(process.env.MONGO),n=!0,console.log("MongoDB connected")}catch(e){throw n=!1,console.error("MongoDB connection error:",e.message),Error("MongoDB connection error")}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[271,798],()=>t(28552));module.exports=o})();