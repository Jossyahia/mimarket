"use strict";(()=>{var e={};e.id=460,e.ids=[460],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},73292:e=>{e.exports=require("fs/promises")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},52610:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>h});var o={};t.r(o),t.d(o,{POST:()=>d});var s=t(10884),n=t(16132),a=t(21040),i=t(67859);t(73292);var p=t(34581),c=t(9816),u=t(53311),l=t.n(u);async function d(e){try{await (0,i.P)();let r=await e.formData(),t=(0,c.eI)("https://frsmcjzgunhzcsxffmyj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyc21janpndW5oemNzeGZmbXlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDIyNTYwMjIsImV4cCI6MjAxNzgzMjAyMn0.7E5qeYynBjG6npduH8eUtm2rUuSnfOOdNbZnV9AHRJw"),o=r.get("creator"),s=r.get("category"),n=r.get("title"),a=r.get("description"),u=r.get("price"),d=r.getAll("workPhotoPaths"),m="fastfastfood",g=[];for(let e of d){let r=e.name.split(".").pop(),o=l()()+"."+r,s=await e.arrayBuffer(),n=Buffer.from(s),a=`${o}`,{data:i,error:p}=await t.storage.from(m).upload(a,n,{contentType:e.type});if(p)return console.error(p),new Response(JSON.stringify({error:p}),{status:500});let c="https://frsmcjzgunhzcsxffmyj.supabase.co/storage/v1/object/public/"+m+"/"+o;console.log(c),g.push(c)}let f=new p.Z({creator:o,category:s,title:n,description:a,price:u,workPhotoPaths:g});return await f.save(),new Response(JSON.stringify(f),{status:200})}catch(e){return console.error(e),new Response("Failed to create a new Work",{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/work/new/route",pathname:"/api/work/new",filename:"route",bundlePath:"app/api/work/new/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\mimarket\\app\\api\\work\\new\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y,headerHooks:w,staticGenerationBailout:h}=m,x="/api/work/new/route";function I(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},34581:(e,r,t)=>{t.d(r,{Z:()=>a});var o=t(11185);let s=new o.Schema({creator:{type:o.Schema.Types.ObjectId,ref:"User"},category:{type:String},title:{type:String},description:{type:String},price:{type:Number},workPhotoPaths:[{type:String}]}),n=o.models.Work||(0,o.model)("Work",s),a=n},67859:(e,r,t)=>{t.d(r,{P:()=>a});var o=t(11185),s=t.n(o);let n=!1,a=async()=>{s().set("strictQuery",!0);try{if(n){console.log("MongoDB is already connected!");return}await s().connect(process.env.MONGO),n=!0,console.log("MongoDB connected")}catch(e){throw n=!1,console.error("MongoDB connection error:",e.message),Error("MongoDB connection error")}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[271,798],()=>t(52610));module.exports=o})();